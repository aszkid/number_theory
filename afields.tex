\section{A primer of algebraic number fields}


Having acquired some algebraic language, we can consider quadratic rings in context. Given a finite field extension $K$ of $\bbQ$ (also called an \emph{algebraic number field}), we consider its subring $\calO_K\subset K$ of elements integral over $\bbZ$. We call this the \emph{ring of integers} of $K$.

An element $k\in K$ is \emph{integral over $\bbZ$} if it satisfies a monic polynomial equation
\[
	k^n + a_{n-1}k^{n-1} + \cdots + a_1k + a_0 = 0
\]
with coefficients $a_i\in\bbZ$.

We note that quadratic fields $\bbQ(\sqrt{D})$ are a special case of general algebraic number fields. Furthermore, any element $x=a+b\sqrt{D}\in\bbZ[\sqrt{D}]$ as defined in ยง1 satisfies the monic polynomial equation $x^2-2ax-(b^2D-a^2)=0$, and any number in $\bbQ(\sqrt{D})$ satisfying such an equation is necessarily of the form $a+b\sqrt{D}$ with $a,b\in\bbZ$.

The classical procedure in number theory is to consider finite extensions $K$ of the field $\bbQ$ by adjoining roots:

\begin{center}
	\begin{tikzcd}
		\calO_L \arrow[r,hook] & L\\
		\calO_K \arrow[u]\arrow[r,hook] & K \arrow[u]\\
		\calO_{\bbQ} = \bbZ \arrow[r,hook]\arrow[u,hook] & \bbQ \arrow[u,hook]
	\end{tikzcd}
\end{center}


Number theorists particularly care about the structure of $\calO_L$ and $\calO_K$, the integral extensions 
\begin{itemize}
	\item What are the units of $\calO_K$ and $\calO_L$?
	\item How do primes $(\mathfrak{p})$ of $\calO_K$ split in $\calO_l$?
\end{itemize}

The first question culminates in \emph{Dirichlet's unit theorem}, which fully describes (???). The second one corresponds to \emph{ramification theory}.


\subsection{Modules and integrality}

The question of integrality is fundamental in the study of number fields, and it proves useful to develop the theory in its full generality.

For a given ring extension $A\subseteq B$, we say that $B$ is \emph{integral over $A$} if each element in $B$ is integral over $A$.

Integral elements of ring extensions have a very nice finiteness property when considering the $A$-module they generate.

\begin{proposition}
	Finitely many elements $b_1,\dots,b_n\in B$ are integral over $A$ iff the $A$-module $A[b_1,\dots,b_n]$ is finitely generated.\footnote{Neukirch 2.2}
\end{proposition}
\begin{proof}
	($\Longrightarrow$) Start by assuming that $b\in B$ is integral over $A$. Then $f(b)=0$ for some polynomial $f(x)$ over $A$. Now let $g(x)\in A[x]$: by the division algorithm, we have $g(x)=q(x)f(x)+r(x)$ with polynomials over $A$ and $\deg r(x) < \deg g(x)$.

	In particular, passing to $A[b]$, we have $g(b)=r(b)=a_0+a_1b+\cdots+a_{n-1}b^{n-1}$. So any element in $A[b]$ is generated by $\{1,b,\dots,b^{n-1}\}$, i.e. $A[b]$ is finitely generated.

	Now assume that $R=A[b_1,\dots,b_{n-1}]$ is finitely generated for $b_1,\dots,b_n\in B$ integral over $A$. The same argument shows that $R[b_n]$ is finitely generated too, since $b_n$ is integral over $A$ and hence over $R$ as well. Induction proves the result.

	($\Longleftarrow$) Now assume that $A[b_1,\dots,b_n]$ is finitely generated. Let $\omega_1,\dots,\omega_r$ be a system of generators. Take any $b\in A[b_1,\dots,b_n]$; we have
	\begin{align*}
		(b-a_{11})\omega_1 + \cdots + (-a_{1r})\omega_r &= 0\\
		\vdots &= 0\\
		(-a_{i1})\omega_1 + \cdots + (b-a_{ii})\omega_i + \cdots + (-a_{ir})\omega_r&=0\\
		\vdots &= 0\\
		(-a_{r1})\omega_1 + \cdots + (b-a_{rr})\omega_r &= 0
	\end{align*}
	for $1\leq i\leq r$. This gives a system of equations, which in matrix form can be written as $bI - (a_{ij})$. We have that $(bI-(a_{ij}))\omega_i = 0$, so $\det(bI-(a_{ij}))\omega_i = 0$, but $\omega_i\neq 0$ so necessarily $\det(bI-(a_{ij}))=0$. This gives a polynomial over $A$ for which $b$ is a root, so $b$ is integral over $A$.
\end{proof}

Note that the result is even stronger: any $b\in A[b_1,\dots,b_n]$ is integral over $A$. Compare this result to an arbitrary ring extension $A[b]$, which is not necessarily finitely generated as an $A$-module, just like the polynomial ring $A[x]$.

Closure of ring operations makes $A[b_1,\dots,b_n]$ into a ring that is integral over $A$, if $b_1,\dots,b_n\in B$ are.

\begin{proposition}
	Let $A\subseteq B\subseteq C$ be ring extensions. If $B$ is integral over $A$ and $C$ is integral over $B$, then $C$ is integral over $A$.
\end{proposition}
\begin{proof}
	Fix $c\in C$: since $C$ is integral over $B$, we have an equation $c^n+b_1c^{n-1}+\cdots+b_n=0$ with coefficients in $B$. In particular $R=A[b_1,\dots,b_n]$ is finitely generated because $B$ is integral over $A$, and $R[c]$ as well because $c$ is integral over $B$. But these two facts combined make $R[c]$ finitely generated over $A$\todo{Why?}, which implies that $c$ is integral over $A$.
\end{proof}

We call the set $\overline{A}=\{b\in B \mid b \text{ integral over } A\}$ the \emph{integral closure of $A$}, and say that $A$ is \emph{integrally closed} if $A=\overline{A}$. Note that $A$ is trivially integral over $A$ because $a\in A$ is a solution to the monic polynomial $x-a=0$, hence $A\subset\overline{A}$. Hence we have the chain $A\subset \overline{A}\subset\overline{\overline{A}}$ of integral closures, and applying the previous proposition we get that $\overline{\overline{A}}$ is integral over $A$, so $\overline{\overline{A}}\subset\overline{A}$. The two inclusions imply that $\overline{A}=\overline{\overline{A}}$, i.e. $\overline{A}$ is integrally closed, so it makes sense to call it the `integral closure' of $A$.


\subsection{Trace and norm}

Consider a finite field extension $L\mid K$. The following concepts will prove useful in studying the integral elements of $L$.

\begin{definition}
	The \emph{trace} and \emph{norm} of some $x\in L$ are defined as the trace and norm of the matrix $[T_x]$ representing the endomorphism $T_x:L\to L$ given by $T_x(\alpha)=x\alpha$, i.e.
	\begin{align*}
		\Tr_{L\mid K}(x) = \Tr([T_x]) & & \N_{L\mid K}(x) = \det([T_x]).
	\end{align*}
\end{definition}

We only need to compute the action of trace and norm on some basis to get the field trace and norm: for example, with $K=\bbR$ and $L=\bbC$, in we have a basis $\{1,i\}$ and so $T_z(1)=a+bi$ and $T_z(i)=-b+ai$. This gives the matrix
\[
	\begin{bmatrix}
		a & -b\\
		b & a
	\end{bmatrix},
\]
the trace and norm of which are $2a$ and $a^2+b^2$, which is the familiar `Euclidean' norm on $\bbC$.\todo{Is this really related to the vector norm?}


\begin{proposition}
	The trace $\Tr_{L\mid K}$ is a $K$-linear additive homomorphism $L\to K$, and the norm $\N_{L\mid K}$ is a multiplicative homomorphism $L^\times\to K^\times$.
\end{proposition}
\begin{proof}
	This amounts to passing to matrix representations as needed.

	First of all, it is clear that $T_{x+y}=T_x+T_y$, and $T_{xy}=T_x\circ T_y$. Now pick a basis for $L\mid K$ and find the matrix representations of $T_x$ and $T_y$. We have that
	\begin{align*}
		\Tr_{L\mid K}(x+y)=\Tr([T_{x+y}])&=\Tr([T_x+T_y])\\
			&=\Tr([T_x])+\Tr([T_y])\\
			&= \Tr_{L\mid K}(x)+\Tr_{L\mid K}(y),
	\end{align*}
	so the `field' trace is at least additive, just as the usual trace is so.

	Similarly, we have
	\begin{align*}
		\N_{L\mid K}(xy) = \det([T_{xy}]) &= \det([T_x][T_y])\\
			&= \det([T_x])\det([T_y])\\
			&= \N_{L\mid K}(x)\N_{L\mid K}(y),
	\end{align*}
	so the `field' norm is multiplicative.

	For $K$-linearity of the trace, fix $c\in K$ and $x\in L$: as an endomorphism, we have $T_{cx}(\alpha)=c T_x(\alpha)$, so
	\begin{align*}
		\Tr_{L\mid K}(cx) = \Tr([T_{cx}]) &= \Tr(c[T_x])\\
			&= c\Tr([T_x])\\
			&= c \Tr_{L\mid K}(x).
	\end{align*}

	And additivity extends this to finitely many terms, so the trace is $K$-linear.
\end{proof}




Given $n=[L : K]$, the characteristic polynomial\footnote{Of course, given by any \emph{matrix representation} of $T_x$, relative to the extension $L\mid K$.} of $T_x$ is
\[
	f_x(t) = \det(tI - [T_x]) = t^n - a_1t^{n-1} + \cdots + (-1)^na_n.
\]
Note that $a_1=\Tr_{L\mid K}(x)$ and $a_n=\N_{L\mid K}(x)$, and the degree of $f_x(t)$ is always fixed relative to $L\mid K$.

On the other hand, the minimal polynomial $p_x(t)$ of any $x\in L$ over $K$ has degree $[K(x) : K]$, which depends on course on the choice of $x$.



We now study the close interplay between the characteristic and the minimal polynomial.

\begin{proposition}
	Every $x \in L$ is a root of the characteristic polynomial of $T_x$.
\end{proposition}
\begin{proof}
	This follows from Cayley-Hamilton: considering $f_x$ as a linear operator, evaluating at the matrix $[T_x]$ is zero by definition, but we can expand it with addition being usual matrix addition, and powers being repeated matrix multiplication. Then
	\begin{align*}
		0 = f_x([T_x]) &= [T_x]^n - a_1[T_x]^{n-1} + \cdots + (-1)^na_n I\\
			&= [T_{x^n}] - a_1[T_{x^{n-1}}] + \cdots + (-1)^na_n I\\
			&= [T_{x^n}] - [T_{a_1x^{n-1}}] + \cdots + (-1)^n_an I\\
			&= [T_{x^n-a_1x^{n-1} + \cdots + (-1)^na_n}]\\
			&= [T_{f_x(x)}],
	\end{align*}
	which implies that $T_{f_x(x)}=0$, i.e. $f_x(x)=0$.
\end{proof}

\begin{proposition}
	Fix $x\in L$, let $p_x(t)$ be the minimal polynomial of $x$ and $f_x(t)$ the characteristic polynomial of $T_x$. Then
	\[
		f_x(t) = (p_x(t))^{n/d},
	\]
	where $n=[L:K]$ and $d=[K(x):K]$.
\end{proposition}
\begin{proof}
	Fix $x\in L$. The set $\{x,x^2,\dots,x^{d-1}\}$ is a basis of $K(x)\mid K$. Pick a basis $\{\alpha_1,\dots,\alpha_m\}$ of $L\mid K(x)$. The set 
	\[
		\{\alpha_1, \alpha_1 x,\alpha_1 x^2, \dots, \alpha_1 x^{d-1}; \alpha_2, \alpha_2 x, \alpha_2 x^2, \dots, \alpha_2 x^{d-1}; \dots ; \alpha_m, \alpha_m x, \dots, \alpha_m x^{d-1}\}
	\]
	is a basis for $L\mid K$.

	We write $T_x$ as a matrix with respect to this basis. Let $e_{ij}$ be the basis vectors of $L$, i.e. $e_{01} = \alpha_1 = (1,0,\dots,0)$, $e_{11} = x \alpha_1 = (0,1,\dots,0)$, etc. Note that for $i<d-1$ we have
	\begin{align*}
		T_x(e_{ij}) = x e_{ij} &= x x^i \alpha_j\\
			&= x^{i+1} \alpha_j\\
			&= e_{(i+1)j},
	\end{align*}
	and for $i=d-1$
	\begin{align*}
		T_x(e_{(d-1)j}) = x^d \alpha_j,
	\end{align*}
	but since $\{x^i\}_{0\leq i \leq d-1}$ is a basis for $K(x)$ we must have some linear combination 
	\begin{align*}
		c_d + x c_{d-1} + \cdots + x^{d-1} c_1 + x^d = 0,
	\end{align*}
	which is in fact the minimal polynomial of $x$ since $d=[K(x):K]$. Hence $T_x(e_{(d-1)j}) = \alpha_j (-c_d - x c_{d-1} - \cdots - x^{d-1} c_1)$.
	
	We have just shown that $T_x$ gives the same matrix for each subspace generated by $\{e_{ij}\}_{0\leq j\leq m}$:
	\[
	\begin{pmatrix}
		0 & 1 & 0 & \cdots & 0\\
		0 & 1 & 1 & \cdots & 0\\
		\cdots & \cdots & \cdots & \cdots & \cdots\\
		0 & 0 & 0 & \cdots & 1\\
		-c_d & -c_{d-1} & -c_{d-2} & \cdots & -c_1
	\end{pmatrix},
	\]
	so to compute the characteristic polynomial of $[T_x]$ it suffices to compute it for the block above. This can be done by using the permutation formula of the determinant\todo{Show work}, which gives
	\[
		t^d + c_1 t^{d-1} + \cdots + c_{d-1} t + c_d = p_x(t).
	\]

	By $[T_x]$ consisting of $m$ identical blocks with determinant $p_x(t)$, we get $f_x(t)=p_x(t)^m$.

\end{proof}

Note that if $L=K(x)$, we have that $f_x(t)=p_x(t)$.


A special form for field trace and norm can be given if $L\mid K$ is a separable extension. Let $d=[L:K(x)]$ and $m=[K(x):K]$, so $[L:K]=dm$.

\begin{proposition}
	Given a separable field extension $L\mid K$ and $\sigma : L\to\overline{K}$ is a $K$-embedding of $L$, we have
	\begin{enumerate}[(i)]
		\item $f_x(t)= \prod_\sigma(t-\sigma x)$,
		\item $\Tr_{L\mid K}(x) = \sum_\sigma \sigma x$, and
		\item $\N_{L\mid K}(x) = \prod_\sigma \sigma x$.
	\end{enumerate}
\end{proposition}
\begin{proof}
	Since $L\mid K$ is separable, $x\in L$ is separable, so there are exactly $m$ $K$-embedding $\tilde{\sigma}:K(x)\to \overline{K}$. Each of these extends to a $K$-embedding $\sigma: L\to \overline{K}$ in $d$ different ways. Since $[L:K]_s=md$, this accounts for all $K$-embeddings $L\to\overline{K}$. Hence we can split $\Hom_K(L,\overline{K})$ into $m$ equivalence classes by identifying $\sigma \sim \tau$ if $\sigma(x)=\tau(x)$ (corresponding to choice of $x^\sigma$); each of the equivalence classes has $d$ distinct embeddings.

	(Another argument: $L$ is a finite extension over $K(x)$, so any element in $L$ can be written as a linear combination of $d$ basis elements in $L$ with coefficients in $K(x)$. A $K$-embedding of $L$ into $\overline{K}$ must decide where $x$ goes (exactly $m$ choices, the degree of $p_x(t)$) and where the $d$ elements of the basis of $L$ go.)

	Hence, taking representatives $\sigma_1,\dots,\sigma_m$, we have
	\begin{align*}
		p_x(t) = \prod_{i=1}^m (t- \sigma_i x),
	\end{align*}
	and by the previous proposition,
	\begin{align*}
		f_x(t) &= \left( p_x(t)\right)^d\\
			&= \left(\prod_{i=1}^m (t-\sigma_i x)\right)^d\\
			&= \prod_\sigma (t-\sigma x),
	\end{align*}
	the last equality being valid since any two embeddings in the same equivalence class agree on $x$.

	Recall the block form of $[T_x]$. Summing along the diagonal gives $-c_1$, which by Vieta is equal to the sum of the roots of $p_x(t)$, i.e. $\sum_{i=1}^m \sigma_i x$. Again, the block is repeated $d$ times, so we have
	\begin{align*}
		\Tr_{L\mid K}(x) &= d \sum_{i=1}^m \sigma_i x\\
			&= \sum_\sigma \sigma x.
	\end{align*}

	Computing the determinant of $[T_x]$ by the permutation formula gives
	\begin{align*}
		\N_{L\mid K} &= \sum_\sigma \sigma x.
	\end{align*}

\end{proof}

The trace and norm behave well as we take field extensions:

\begin{corollary}
	Given a tower of finite field extensions $K\subset L\subset M$, we have
	\begin{align*}
		\Tr_{L\mid K} \circ \Tr_{M\mid L} = \Tr_{M\mid K}, & & \N_{L\mid K} \circ \N_{M\mid L} = \N_{M\mid K}.
	\end{align*}
\end{corollary}
\begin{proof}
	Using a similar technique as in the proposition above, we partition $\Hom_K(M,\overline{K})$ into $m=[L:K]$ equivalence classes by identifying $\sigma\sim\tau$ if $\sigma|_L = \tau|_L$. Take a system of representatives $\sigma_1,\dots,\sigma_m$: then $\Hom_K(L,\overline{K}) = \{\sigma_i|_L , 1\leq i \leq m\}$.

	Fix $x\in M$. We have
	\begin{align*}
		\Tr_{M\mid K}(x) &= \sum_\sigma \sigma x\\
			&= \sum_{i=1}^m \sum_{\sigma\sim\sigma_i} \sigma x\\
			&= \sum_{i=1}^m \Tr_{\sigma_i M\mid \sigma_i L}(\sigma_i x)\\
			&= \sum_{i=1}^m \sigma_i \Tr_{M\mid L}(x)\\
			&= \Tr_{L\mid K}(\Tr_{M\mid L}(x)).
	\end{align*}
	\todo{Develop third equality.}

\end{proof}


Given a basis $\alpha_1,\dots,\alpha_n$ of a separable field extension $L\mid K$, we define its \emph{discriminant} by
\[
	d(\alpha_1,\dots,\alpha_n) = \det((\sigma_i\alpha_j))^2,
\]
where $\sigma_i$ varies over $K$-embeddings $L\to\overline{K}$.\todo{Write discriminant in terms of trace and in the special case of a simple extension.}


\begin{proposition}
	If $L\mid K$ is separable and $\alpha_1,\dots,\alpha_n$ is a basis for $L$, we have that $d(\alpha_1,\dots,\alpha_n)\neq 0$ and $(x,y) \to \Tr_{L\mid K}(xy)$ is a nondegenerate bilinear form on $L$ as a $K$-vector space.
\end{proposition}
\begin{proof}
	A routine computation shows that $(x,y)$ is indeed linear on each coordinate.

	Recall that a bilinear form $(x,y)$ can be expressed by a matrix $M$, so that $(x,y) = x^T M y$. Non-degeneracy is equivalent to requiring $\det(M)\neq 0$.
	
	Since $L\mid K$ is separable, the primitive element theorem gives some $\theta\in L$ for which $L=K(\theta)$. Hence
	\[
		\det(M) = \prod_{i<j}(\theta_i-\theta_j)^2 \neq 0,
	\]
	since otherwise $\theta_i = \theta_j$, implying that $\sigma_i=\sigma_j$, a contradiction.

	Denote the bilinear form $(x,y)$ with respect to some other basis $\alpha_1,\dots,\alpha_n$ by $M'$. Using a change of basis, we have $M=SM'S\inv$. Take the determinant on both sides to get $0\neq\det(M)=\det(S)\det(M')\det(S\inv)=\det(M')$.
\end{proof}



\subsection{Integrality continued -- integral bases}


The main use of integrality we care about in this presentation concerns $\calO_K$, for some algebraic number field $K$. We have shown that any finitely generated $\calO_K$-submodule $\fraka$ of $K$ admits a $\bbZ$-graded basis $\alpha_1,\dots,\alpha_n$.

Since the discriminant is independent of any choice of basis, we can write $\d(\fraka)$.

...

We remind ourselves of the usual setup: we have an integrally closed integral domain $A$, its field of fractions $K$, a finite separable extension $L\mid K$, and the integral closure $B$ of $A$ in $L$. The classical equivalent is given by $A=\bbZ$, $K=\bbQ$, $L$ a quadratic field, a cyclotomic field, etc., and $B=\calO_K$ the ring of integers.

Note that $x\in B$ implies that all its conjugates $\sigma x$ are integral in $L$ too. Hence $\Tr_{L\mid K}(x)$ and $\N_{L\mid K}(x)$ are in $A$.

(define integral basis)

\begin{lemma}
	If $\alpha_1,\dots,\alpha_n$ is a basis of $L$ contained in $B$, we have
	\[
		dB\subseteq A\alpha_1 + \cdots + A\alpha_n.
	\]
\end{lemma}


\begin{proposition}
	If $A$ is a PID and $M$ is a finitely-generated $B$-submodule, then $M$ is a free $A$-module and it admits of an integral basis.
\end{proposition}
\begin{proof}
\end{proof}

In particular, this holds for $B$. The classical statement gives $\calO_K$ a very nice free $\bbZ$-module presentation.
